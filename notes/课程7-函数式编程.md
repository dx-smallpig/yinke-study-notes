# å‡½æ•°å¼ç¼–ç¨‹

## ä¸€ã€ä¸€ç­‰å…¬æ°‘å‡½æ•°

### 1.1 æ¦‚è§ˆ

å‡½æ•°æ˜¯â€œä¸€ç­‰å…¬æ°‘â€å®é™…ä¸Šè¯´çš„æ˜¯å®ƒä»¬å’Œå…¶ä»–å¯¹è±¡éƒ½ä¸€æ ·...æ‰€ä»¥å°±æ˜¯æ™®é€šå…¬æ°‘ï¼ˆåç»æµèˆ±çš„äººï¼Ÿï¼‰ã€‚æ¢å¥è¯è¯´ï¼Œå‡½æ•°æ²¡ä»€ä¹ˆç‰¹æ®Šçš„ï¼Œä½ å¯ä»¥åƒå¯¹å¾…ä»»ä½•å…¶ä»–æ•°æ®ç±»å‹ä¸€æ ·å¯¹å¾…å®ƒä»¬â€”â€”æŠŠå®ƒä»¬å­˜åœ¨æ•°ç»„é‡Œï¼Œå½“ä½œå‚æ•°ä¼ é€’ï¼Œèµ‹å€¼ç»™å˜é‡...ç­‰ç­‰ã€‚

è¿™æ˜¯ JavaScript è¯­è¨€çš„åŸºç¡€æ¦‚å¿µï¼Œä¸è¿‡è¿˜æ˜¯å€¼å¾—æä¸€æçš„ï¼Œå¤§å¤šæ•°äººå¯¹è¿™ä¸ªæ¦‚å¿µé›†ä½“æ— è§†ï¼Œæˆ–è€…ä¹Ÿå¯èƒ½æ˜¯æ— çŸ¥ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªæœæ’°çš„ä¾‹å­ï¼š

```javascript
const hi = name => `Hi ${name}`;
const greeting = name => hi(name);
```

è¿™é‡Œ `greeting` æŒ‡å‘çš„é‚£ä¸ªæŠŠ `hi` åŒ…äº†ä¸€å±‚çš„åŒ…è£¹å‡½æ•°å®Œå…¨æ˜¯å¤šä½™çš„ã€‚ä¸ºä»€ä¹ˆï¼Ÿå› ä¸º JavaScript çš„å‡½æ•°æ˜¯å¯è°ƒç”¨çš„ï¼Œå½“ `hi` åé¢ç´§è·Ÿ () çš„æ—¶å€™å°±ä¼šè¿è¡Œå¹¶è¿”å›ä¸€ä¸ªå€¼ï¼›å¦‚æœæ²¡æœ‰ ()ï¼Œhi å°±ç®€å•åœ°è¿”å›å­˜åˆ°è¿™ä¸ªå˜é‡é‡Œçš„å‡½æ•°ã€‚æˆ‘ä»¬æ¥ç¡®è®¤ä¸€ä¸‹ï¼š

```javascript
hi; // name => `Hi ${name}`
hi("jonas"); // "Hi jonas"
```

`greeting` åªä¸è¿‡æ˜¯è½¬äº†ä¸ªèº«ç„¶åä»¥ç›¸åŒçš„å‚æ•°è°ƒç”¨äº† hi å‡½æ•°è€Œå·²ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå†™ï¼š

```javascript
const greeting = hi;
greeting("times"); // "Hi times"
```

æ¢å¥è¯è¯´ï¼Œhi å·²ç»æ˜¯ä¸ªæ¥å—ä¸€ä¸ªå‚æ•°çš„å‡½æ•°äº†ï¼Œè€Œå®ƒä»…ä»…æ˜¯ç”¨è¿™ä¸ªç›¸åŒçš„å‚æ•°è°ƒç”¨ hiï¼Œè¿™æ ·å®Œå…¨å¤šæ­¤ä¸€ä¸¾ã€‚

ç”¨ä¸€ä¸ªå‡½æ•°æŠŠå¦ä¸€ä¸ªå‡½æ•°åŒ…èµ·æ¥ï¼Œç›®çš„ä»…ä»…æ˜¯å»¶è¿Ÿæ‰§è¡Œï¼ŒçœŸçš„æ˜¯éå¸¸ç³Ÿç³•çš„ç¼–ç¨‹ä¹ æƒ¯ã€‚

æ¥ä¸‹æ¥çœ‹å‡ ä¸ªä¾‹å­ï¼š

```javascript
// bad
const getServerStuff = callback => ajaxCall(json => callback(json));

// good
const getServerStuff = ajaxCall;
```

ç­‰åŒäº

```javascript
// è°ƒç”¨getServerStuffä¼ é€’çš„å‚æ•°æ˜¯callback
// jsonå½¢å‚æ²¡æœ‰ä½œç”¨ï¼Œæ¥æ”¶ä¸åˆ°å®å‚
ajaxCall(json => callback(json));
// ç­‰ä»·äº
ajaxCall(callback);

// é‚£ä¹ˆï¼Œé‡æ„ä¸‹ getServerStuff
const getServerStuff = callback => ajaxCall(callback);

// ...å°±ç­‰äº
const getServerStuff = ajaxCall // <-- çœ‹ï¼Œæ²¡æœ‰æ‹¬å·å“¦
```

æ‰€ä»¥ä»¥ä¸Šæ‰æ˜¯å†™å‡½æ•°çš„æ­£ç¡®æ–¹å¼ï¼š

```javascript
const BlogController = {
  index(posts) { return Views.index(posts); },
  show(post) { return Views.show(post); },
  create(attrs) { return Db.create(attrs); },
  update(post, attrs) { return Db.update(post, attrs); },
  destroy(post) { return Db.destroy(post); },
};
```

è¿™ä¸ªController99% çš„ä»£ç éƒ½æ˜¯åƒåœ¾ï¼Œå¯ä»¥é‡å†™ä¸ºï¼š

```javascript
const BlogController = {
  index: Views.index,
  show: Views.show,
  create: Db.create,
  update: Db.update,
  destroy: Db.destroy,
};
```

æˆ–è€…ç›´æ¥å…¨éƒ¨åˆ æ‰ï¼Œå› ä¸ºå®ƒçš„ä½œç”¨ä»…ä»…å°±æ˜¯æŠŠè§†å›¾ï¼ˆViewsï¼‰å’Œæ•°æ®åº“ï¼ˆDbï¼‰æ‰“åŒ…åœ¨ä¸€èµ·è€Œå·²ã€‚

### 1.2 ä½•ä¸ºå‡½æ•°å¼ä¸€ç­‰å…¬æ°‘

å›é¡¾ä¸‹å‰é¢çš„ä»£ç ï¼Œ `getServerStuff`å’Œ `BlogController`ï¼Œè™½è¯´æ·»åŠ ä¸€äº›æ²¡æœ‰å®é™…ç”¨å¤„çš„é—´æ¥å±‚å®ç°èµ·æ¥å¾ˆå®¹æ˜“ï¼Œä½†è¿™æ ·åšé™¤äº†å¾’å¢ä»£ç é‡ï¼Œæé«˜ç»´æŠ¤å’Œæ£€ç´¢ä»£ç çš„æˆæœ¬å¤–ï¼Œæ²¡æœ‰ä»»ä½•ç”¨å¤„ã€‚

å¦å¤–ï¼Œå¦‚æœä¸€ä¸ªå‡½æ•°è¢«ä¸å¿…è¦åœ°åŒ…è£¹èµ·æ¥äº†ï¼Œè€Œä¸”å‘ç”Ÿäº†æ”¹åŠ¨ï¼Œé‚£ä¹ˆåŒ…è£¹å®ƒçš„é‚£ä¸ªå‡½æ•°ä¹Ÿè¦åšç›¸åº”çš„å˜æ›´ã€‚

```javascript
httpGet('/post/2', json => renderPost(json));
```

å¦‚æœ httpGet è¦æ”¹æˆå¯ä»¥æŠ›å‡ºä¸€ä¸ªå¯èƒ½å‡ºç°çš„ err å¼‚å¸¸ï¼Œé‚£æˆ‘ä»¬è¿˜è¦å›è¿‡å¤´å»æŠŠâ€œèƒ¶æ°´â€å‡½æ•°ä¹Ÿæ”¹äº†ã€‚

```javascript
// æŠŠæ•´ä¸ªåº”ç”¨é‡Œçš„æ‰€æœ‰ httpGet è°ƒç”¨éƒ½æ”¹æˆè¿™æ ·ï¼Œå¯ä»¥ä¼ é€’ err å‚æ•°ã€‚
httpGet('/post/2', (json, err) => renderPost(json, err));
```

å†™æˆä¸€ç­‰å…¬æ°‘å‡½æ•°çš„å½¢å¼ï¼Œè¦åšçš„æ”¹åŠ¨å°†ä¼šå°‘å¾—å¤šï¼š

```javascript
httpGet('/post/2', renderPost);  // renderPost å°†ä¼šåœ¨ httpGet ä¸­è°ƒç”¨ï¼Œæƒ³è¦å¤šå°‘å‚æ•°éƒ½è¡Œ
```

é™¤äº†åˆ é™¤ä¸å¿…è¦çš„å‡½æ•°ï¼Œæ­£ç¡®åœ°ä¸ºå‚æ•°å‘½åä¹Ÿå¿…ä¸å¯å°‘ã€‚å½“ç„¶å‘½åä¸æ˜¯ä»€ä¹ˆå¤§é—®é¢˜ï¼Œä½†è¿˜æ˜¯æœ‰å¯èƒ½å­˜åœ¨ä¸€äº›ä¸å½“çš„å‘½åï¼Œå°¤å…¶éšç€ä»£ç é‡çš„å¢é•¿ä»¥åŠéœ€æ±‚çš„å˜æ›´ï¼Œè¿™ç§å¯èƒ½æ€§ä¹Ÿä¼šå¢åŠ ã€‚

é¡¹ç›®ä¸­å¸¸è§çš„ä¸€ç§é€ æˆæ··æ·†çš„åŸå› æ˜¯ï¼Œé’ˆå¯¹åŒä¸€ä¸ªæ¦‚å¿µä½¿ç”¨ä¸åŒçš„å‘½åã€‚è¿˜æœ‰é€šç”¨ä»£ç çš„é—®é¢˜ã€‚æ¯”å¦‚ï¼Œä¸‹é¢è¿™ä¸¤ä¸ªå‡½æ•°åšçš„äº‹æƒ…ä¸€æ¨¡ä¸€æ ·ï¼Œä½†åä¸€ä¸ªå°±æ˜¾å¾—æ›´åŠ é€šç”¨ï¼Œå¯é‡ç”¨æ€§ä¹Ÿæ›´é«˜ï¼š

```javascript
// åªé’ˆå¯¹å½“å‰çš„åšå®¢
const validArticles = articles =>
  articles.filter(article => article !== null && article !== undefined),

// å¯¹æœªæ¥çš„é¡¹ç›®æ›´å‹å¥½
const compact = xs => xs.filter(x => x !== null && x !== undefined);
```

åœ¨å‘½åçš„æ—¶å€™ï¼Œæˆ‘ä»¬ç‰¹åˆ«å®¹æ˜“æŠŠè‡ªå·±é™å®šåœ¨ç‰¹å®šçš„æ•°æ®ä¸Šï¼ˆæœ¬ä¾‹ä¸­æ˜¯ `articles`ï¼‰ã€‚è¿™ç§ç°è±¡å¾ˆå¸¸è§ï¼Œä¹Ÿæ˜¯é‡å¤é€ è½®å­çš„ä¸€å¤§åŸå› ã€‚

æœ‰ä¸€ç‚¹æˆ‘å¿…é¡»å¾—æŒ‡å‡ºï¼Œä½ ä¸€å®šè¦éå¸¸å°å¿ƒ this å€¼ï¼Œè¿™ä¸€ç‚¹ä¸é¢å‘å¯¹è±¡ä»£ç ç±»ä¼¼ã€‚å¦‚æœä¸€ä¸ªåº•å±‚å‡½æ•°ä½¿ç”¨äº† thisï¼Œè€Œä¸”æ˜¯ä»¥ä¸€ç­‰å…¬æ°‘çš„æ–¹å¼è¢«è°ƒç”¨çš„ï¼Œé‚£å°±å¾ˆå®¹æ˜“æ‰è¿›thisçš„å‘é‡Œï¼ˆè¯¾ä¸Šä»£ç å·²ç»è®²çš„è¶³å¤Ÿå¤šäº†ï¼‰ã€‚

```javascript
var fs = require('fs');

// bad
fs.readFile('freaky_friday.txt', Db.save);

// good a little
fs.readFile('freaky_friday.txt', Db.save.bind(Db));
```

æŠŠ Db ç»‘å®šï¼ˆbindï¼‰åˆ°å®ƒè‡ªå·±èº«ä¸Šä»¥åï¼Œä½ å°±å¯ä»¥éšå¿ƒæ‰€æ¬²åœ°è°ƒç”¨å®ƒçš„åŸå‹é“¾å¼äº†ã€‚

this æœ‰åˆ©æœ‰å¼Šï¼Œå¦‚æœä¸ç†Ÿæ‚‰ï¼Œå°½é‡é¿å…ä½¿ç”¨å®ƒï¼Œå› ä¸ºåœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­æ ¹æœ¬ç”¨ä¸åˆ°å®ƒã€‚ç„¶è€Œï¼Œåœ¨ä½¿ç”¨å…¶ä»–çš„ç±»åº“æ—¶ï¼Œå¯èƒ½ä¼šå‘ç°å„ç§å„æ ·å…³äºthisçš„ä½¿ç”¨ã€‚

## äºŒã€çº¯å‡½æ•°

### 2.1 ä»€ä¹ˆæ˜¯çº¯å‡½æ•°

çº¯å‡½æ•°æ˜¯è¿™æ ·ä¸€ç§å‡½æ•°ï¼Œå³ç›¸åŒçš„è¾“å…¥ï¼Œæ°¸è¿œä¼šå¾—åˆ°ç›¸åŒçš„è¾“å‡ºï¼Œè€Œä¸”æ²¡æœ‰ä»»ä½•å¯è§‚å¯Ÿçš„å‰¯ä½œç”¨ã€‚

æ¯”å¦‚æ•°ç»„çš„ `slice` å’Œ `splice`ï¼Œè¿™ä¸¤ä¸ªå‡½æ•°çš„ä½œç”¨å¹¶æ— äºŒè‡´â€”â€”ä½†æ˜¯æ³¨æ„ï¼Œå®ƒä»¬å„è‡ªçš„æ–¹å¼å´å¤§ä¸åŒï¼Œä½†ä¸ç®¡æ€ä¹ˆè¯´ä½œç”¨è¿˜æ˜¯ä¸€æ ·çš„ã€‚

- `slice` ç¬¦åˆçº¯å‡½æ•°çš„å®šä¹‰ï¼šå› ä¸ºå¯¹ç›¸åŒçš„è¾“å…¥å®ƒä¿è¯èƒ½è¿”å›ç›¸åŒçš„è¾“å‡ºï¼›
- `splice `å´ä¸åŒï¼šä¼šäº§ç”Ÿå¯è§‚å¯Ÿåˆ°çš„å‰¯ä½œç”¨ï¼Œå³è¿™ä¸ªæ•°ç»„æ°¸ä¹…åœ°æ”¹å˜äº†ï¼›

```javascript
var xs = [1,2,3,4,5];

// çº¯çš„
xs.slice(0,3);
//=> [1,2,3]

xs.slice(0,3);
//=> [1,2,3]

xs.slice(0,3);
//=> [1,2,3]


// ä¸çº¯çš„
xs.splice(0,3);
//=> [1,2,3]

xs.splice(0,3);
//=> [4,5]

xs.splice(0,3);
//=> []
```

åœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬è¿½æ±‚çš„æ˜¯é‚£ç§å¯é çš„ï¼Œæ¯æ¬¡éƒ½èƒ½è¿”å›åŒæ ·ç»“æœçš„å‡½æ•°ï¼Œè€Œä¸æ˜¯åƒ `splice` è¿™æ ·æ¯æ¬¡è°ƒç”¨åéƒ½æŠŠæ•°æ®å¼„å¾—ä¸€å›¢ç³Ÿçš„å‡½æ•°ã€‚

æ¥çœ‹çœ‹å¦ä¸€ä¸ªä¾‹å­ï¼š

```javascript
// ä¸çº¯çš„
var minimum = 21;

var checkAge = function(age) {
  return age >= minimum;
};


// çº¯çš„
var checkAge = function(age) {
  var minimum = 21;
  return age >= minimum;
};
```

åœ¨ä¸çº¯çš„ç‰ˆæœ¬ä¸­ï¼Œ`checkAge` çš„ç»“æœå°†å–å†³äº `minimum` è¿™ä¸ªå¯å˜å˜é‡çš„å€¼ã€‚æ¢å¥è¯è¯´ï¼Œå®ƒå–å†³äºç³»ç»ŸçŠ¶æ€ï¼ˆ`system state`ï¼‰ï¼›å› ä¸ºå®ƒå¼•å…¥äº†å¤–éƒ¨çš„ç¯å¢ƒï¼Œä»è€Œå¢åŠ äº†è®¤çŸ¥è´Ÿè·ï¼ˆ`cognitive load`ï¼‰ã€‚

è¿™ä¸ªä¾‹å­å¯èƒ½è¿˜ä¸æ˜¯é‚£ä¹ˆæ˜æ˜¾ï¼Œä½†è¿™ç§ä¾èµ–çŠ¶æ€æ˜¯å½±å“ç³»ç»Ÿå¤æ‚åº¦çš„ç½ªé­ç¥¸é¦–ã€‚è¾“å…¥å€¼ä¹‹å¤–çš„å› ç´ èƒ½å¤Ÿå·¦å³ `checkAge` çš„è¿”å›å€¼ï¼Œä¸ä»…è®©å®ƒå˜å¾—ä¸çº¯ï¼Œè€Œä¸”å¯¼è‡´æ¯æ¬¡æˆ‘ä»¬æ€è€ƒæ•´ä¸ªè½¯ä»¶çš„æ—¶å€™éƒ½ç—›è‹¦ä¸å ªã€‚

å¦ä¸€æ–¹é¢ï¼Œä½¿ç”¨çº¯å‡½æ•°çš„å½¢å¼ï¼Œå‡½æ•°å°±èƒ½åšåˆ°è‡ªç»™è‡ªè¶³ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥è®© `minimum` æˆä¸ºä¸€ä¸ªä¸å¯å˜ï¼ˆ`immutable`ï¼‰å¯¹è±¡ï¼Œè¿™æ ·å°±èƒ½ä¿ç•™çº¯ç²¹æ€§ï¼Œå› ä¸ºçŠ¶æ€ä¸ä¼šæœ‰å˜åŒ–ã€‚è¦å®ç°è¿™ä¸ªæ•ˆæœï¼Œå¿…é¡»å¾—åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œç„¶åè°ƒç”¨ `Object.freeze` æ–¹æ³•ï¼š

```javascript
var immutableState = Object.freeze({
  minimum: 21
});
```



### 2.2 å‰¯ä½œç”¨å†…å®¹

å‰¯ä½œç”¨æ˜¯åœ¨è®¡ç®—ç»“æœçš„è¿‡ç¨‹ä¸­ï¼Œç³»ç»ŸçŠ¶æ€çš„ä¸€ç§å˜åŒ–ï¼Œæˆ–è€…ä¸å¤–éƒ¨ä¸–ç•Œè¿›è¡Œçš„å¯è§‚å¯Ÿçš„äº¤äº’ã€‚

å‰¯ä½œç”¨å¯èƒ½åŒ…å«ï¼Œä½†ä¸é™äºï¼š

1. æ›´æ”¹æ–‡ä»¶ç³»ç»Ÿï¼›
2. å¾€æ•°æ®åº“æ’å…¥è®°å½•ï¼›
3. å‘é€ä¸€ä¸ª http è¯·æ±‚ï¼›
4. å¯å˜æ•°æ®ï¼›
5. æ‰“å°/logï¼›
6. è·å–ç”¨æˆ·è¾“å…¥ï¼›
7. DOM æŸ¥è¯¢ï¼›
8. è®¿é—®ç³»ç»ŸçŠ¶æ€...

æ¦‚æ‹¬æ¥è®²ï¼Œåªè¦æ˜¯è·Ÿå‡½æ•°å¤–éƒ¨ç¯å¢ƒå‘ç”Ÿçš„äº¤äº’å°±éƒ½æ˜¯å‰¯ä½œç”¨â€”â€”è¿™ä¸€ç‚¹å¯èƒ½ä¼šè®©ä½ æ€€ç–‘æ— å‰¯ä½œç”¨ç¼–ç¨‹çš„å¯è¡Œæ€§ã€‚å‡½æ•°å¼ç¼–ç¨‹çš„å“²å­¦å°±æ˜¯å‡å®šå‰¯ä½œç”¨æ˜¯é€ æˆä¸æ­£å½“è¡Œä¸ºçš„ä¸»è¦åŸå› ã€‚

è¿™å¹¶ä¸æ˜¯è¯´ï¼Œè¦ç¦æ­¢ä½¿ç”¨ä¸€åˆ‡å‰¯ä½œç”¨ï¼Œè€Œæ˜¯è¯´ï¼Œè¦è®©å®ƒä»¬åœ¨å¯æ§çš„èŒƒå›´å†…å‘ç”Ÿã€‚

å‰¯ä½œç”¨è®©ä¸€ä¸ªå‡½æ•°å˜å¾—ä¸çº¯æ˜¯æœ‰é“ç†çš„ï¼šä»å®šä¹‰ä¸Šæ¥è¯´ï¼Œçº¯å‡½æ•°å¿…é¡»è¦èƒ½å¤Ÿæ ¹æ®ç›¸åŒçš„è¾“å…¥è¿”å›ç›¸åŒçš„è¾“å‡ºï¼›å¦‚æœå‡½æ•°éœ€è¦è·Ÿå¤–éƒ¨äº‹ç‰©æ‰“äº¤é“ï¼Œé‚£ä¹ˆå°±æ— æ³•ä¿è¯è¿™ä¸€ç‚¹äº†ã€‚

### 2.3 demo

å‡½æ•°æ˜¯ä¸¤ç§æ•°å€¼ä¹‹é—´çš„å…³ç³»ï¼šè¾“å…¥å’Œè¾“å‡ºã€‚å°½ç®¡æ¯ä¸ªè¾“å…¥éƒ½åªä¼šæœ‰ä¸€ä¸ªè¾“å‡ºï¼Œä½†ä¸åŒçš„è¾“å…¥å´å¯ä»¥æœ‰ç›¸åŒçš„è¾“å‡ºã€‚ä¸‹å›¾å±•ç¤ºäº†ä¸€ä¸ªåˆæ³•çš„ä» x åˆ° y çš„å‡½æ•°å…³ç³»ï¼›

![image-20240617110928480](https://gitee.com/dx-smallpig/typora-image/raw/master/images/image-20240617110928480.png)

ä¸‹é¢è¿™å¼ å›¾è¡¨å±•ç¤ºçš„å°±ä¸æ˜¯ä¸€ç§å‡½æ•°å…³ç³»ï¼Œå› ä¸ºè¾“å…¥å€¼ 5 æŒ‡å‘äº†å¤šä¸ªè¾“å‡ºï¼š

![image-20240617110945053](https://gitee.com/dx-smallpig/typora-image/raw/master/images/image-20240617110945053.png)

å‡½æ•°å¯ä»¥æè¿°ä¸ºä¸€ä¸ªé›†åˆï¼Œè¿™ä¸ªé›†åˆé‡Œçš„å†…å®¹æ˜¯ (è¾“å…¥, è¾“å‡º) å¯¹ï¼š[(1,2), (3,6), (5,10)]ã€‚

æˆ–è€…ï¼š

```javascript
var toLowerCase = {"A":"a", "B": "b", "C": "c", "D": "d", "E": "e", "D": "d"};

toLowerCase["C"];
//=> "c"

var isPrime = {1:false, 2: true, 3: true, 4: false, 5: true, 6:false};

isPrime[3];
//=> true
```

å½“ç„¶å®é™…æƒ…å†µä¸­ï¼Œå¯èƒ½éœ€è¦è¿›è¡Œä¸€äº›è®¡ç®—è€Œä¸æ˜¯æ‰‹åŠ¨æŒ‡å®šå„é¡¹å€¼ï¼›ä¸è¿‡ä¸Šä¾‹å€’æ˜¯è¡¨æ˜äº†å¦å¤–ä¸€ç§æ€è€ƒå‡½æ•°çš„æ–¹å¼ã€‚

ä»æ•°å­¦çš„æ¦‚å¿µä¸Šè®²ï¼Œçº¯å‡½æ•°å°±æ˜¯æ•°å­¦ä¸Šçš„å‡½æ•°ï¼Œè€Œä¸”æ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„å…¨éƒ¨ã€‚ä½¿ç”¨è¿™äº›çº¯å‡½æ•°ç¼–ç¨‹èƒ½å¤Ÿå¸¦æ¥å¤§é‡çš„å¥½å¤„ï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸ºä½•è¦ä¸é—ä½™åŠ›åœ°ä¿ç•™å‡½æ•°çš„çº¯ç²¹æ€§çš„åŸå› ã€‚

### 2.4 è¿½æ±‚çº¯å‡½æ•°çš„åŸå› 

#### 2.4.1 å¯ç¼“å­˜æ€§ï¼ˆCacheableï¼‰

é¦–å…ˆï¼Œçº¯å‡½æ•°æ€»èƒ½å¤Ÿæ ¹æ®è¾“å…¥æ¥åšç¼“å­˜ã€‚å®ç°ç¼“å­˜çš„ä¸€ç§å…¸å‹æ–¹å¼æ˜¯ `memoize` æŠ€æœ¯ï¼š

```javascript
// ç¼“å­˜å‡½æ•°
function memorize(fn) {
  // ç¼“å­˜åŒº
  const cache = {};
  // const cache = new Map();

  // æŸ¯é‡ŒåŒ–å®ç°ç¼“å­˜å‘½ä¸­
  return function () {
    // å¦‚æœæˆ‘ç°åœ¨çš„å…¥å‚ç»™å®šäº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æŠŠè¿™ä¸ªå…¥å‚å¤„ç†ä¹‹åä½œä¸º Keyï¼Œå‡½æ•°ç»“æœä½œä¸º Valueï¼Œå­˜å…¥ç¼“å­˜åŒº
    const argsStr = JSON.stringify(arguments);
    // å‘½ä¸­ç¼“å­˜
    const cacheValue = cache[argsStr];
    if (cacheValue) {
      console.log("ğŸš€ ~ memorize ~ cacheValue:", "ç¼“å­˜å‘½ä¸­");
      return cacheValue;
    }
    // ç¼“å­˜æœªå‘½ä¸­
    // è¿™æ ·å†™ä¸¢å¤±äº†ä¸Šä¸‹æ–‡
    const value = fn.apply(null, arguments);
    cache[argsStr] = value;
    return value;
  };
}

// ç”¨äºå‡½æ•°ç¼“å­˜
function add(a, b) {
  // å ç”¨æˆ‘ä»¬è®¡ç®—èµ„æº
  for (let i = 0; i < 1000000000; i++) {
    // do nothing
  }
  return a + b;
}

// åˆ›å»ºç¼“å­˜å‡½æ•°
const memorizedAdd = memorize(add);

log(memorizedAdd(1, 2)); // 3
log(memorizedAdd(1, 2)); // 3	ç¼“å­˜å‘½ä¸­
log(memorizedAdd(1, 2)); // 3	ç¼“å­˜å‘½ä¸­
```

å€¼å¾—æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œå¯ä»¥é€šè¿‡å»¶è¿Ÿæ‰§è¡Œçš„æ–¹å¼æŠŠä¸çº¯çš„å‡½æ•°è½¬æ¢ä¸ºçº¯å‡½æ•°ï¼š

```javascript
var pureHttpCall = memoize(function(url, params){
  return function() { return $.getJSON(url, params); }
});
```

è¿™é‡Œæœ‰è¶£çš„åœ°æ–¹åœ¨äºæˆ‘ä»¬å¹¶æ²¡æœ‰çœŸæ­£å‘é€ http è¯·æ±‚â€”â€”åªæ˜¯è¿”å›äº†ä¸€ä¸ªå‡½æ•°ï¼Œå½“è°ƒç”¨å®ƒçš„æ—¶å€™æ‰ä¼šå‘è¯·æ±‚ã€‚è¿™ä¸ªå‡½æ•°ä¹‹æ‰€ä»¥æœ‰èµ„æ ¼æˆä¸ºçº¯å‡½æ•°ï¼Œæ˜¯å› ä¸ºå®ƒæ€»æ˜¯ä¼šæ ¹æ®ç›¸åŒçš„è¾“å…¥è¿”å›ç›¸åŒçš„è¾“å‡ºï¼šç»™å®šäº† url å’Œ params ä¹‹åï¼Œå®ƒå°±åªä¼šè¿”å›åŒä¸€ä¸ªå‘é€ http è¯·æ±‚çš„å‡½æ•°ã€‚

`memoize` å‡½æ•°å·¥ä½œèµ·æ¥æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œè™½ç„¶å®ƒç¼“å­˜çš„å¹¶ä¸æ˜¯ http è¯·æ±‚æ‰€è¿”å›çš„ç»“æœï¼Œè€Œæ˜¯ç”Ÿæˆçš„å‡½æ•°ã€‚

#### 2.4.2 å¯ç§»æ¤æ€§ / è‡ªæ–‡æ¡£åŒ–ï¼ˆPortable / Self-Documentingï¼‰

çº¯å‡½æ•°æ˜¯å®Œå…¨è‡ªç»™è‡ªè¶³çš„ï¼Œå®ƒéœ€è¦çš„æ‰€æœ‰ä¸œè¥¿éƒ½èƒ½è½»æ˜“è·å¾—ã€‚ä»”ç»†æ€è€ƒæ€è€ƒè¿™ä¸€ç‚¹...è¿™ç§è‡ªç»™è‡ªè¶³çš„å¥½å¤„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿé¦–å…ˆï¼Œçº¯å‡½æ•°çš„ä¾èµ–å¾ˆæ˜ç¡®ï¼Œå› æ­¤æ›´æ˜“äºè§‚å¯Ÿå’Œç†è§£ã€‚

```javascript
// ä¸çº¯çš„
var signUp = function(attrs) {
  var user = saveUser(attrs);
  welcomeUser(user);
};

var saveUser = function(attrs) {
    var user = Db.save(attrs);
    ...
};

var welcomeUser = function(user) {
    Email(user, ...);
    ...
};

// çº¯çš„
var signUp = function(Db, Email, attrs) {
  return function() {
    var user = saveUser(Db, attrs);
    welcomeUser(Email, user);
  };
};

var saveUser = function(Db, attrs) {
    ...
};

var welcomeUser = function(Email, user) {
    ...
};
```

è¿™ä¸ªä¾‹å­è¡¨æ˜ï¼Œçº¯å‡½æ•°å¯¹äºå…¶ä¾èµ–å¿…é¡»è¦æ˜ç¡®ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½çŸ¥é“å®ƒçš„ç›®çš„ã€‚

ä»…ä»çº¯å‡½æ•°ç‰ˆæœ¬çš„ `signUp` çš„ç­¾åå°±å¯ä»¥çœ‹å‡ºï¼Œå®ƒå°†è¦ç”¨åˆ° `Db`ã€`Email` å’Œ `attrs`ï¼Œè¿™åœ¨æœ€å°ç¨‹åº¦ä¸Šç»™äº†æˆ‘ä»¬è¶³å¤Ÿå¤šçš„ä¿¡æ¯ã€‚

å…¶æ¬¡ï¼Œé€šè¿‡å¼ºè¿«â€œæ³¨å…¥â€ä¾èµ–ï¼Œæˆ–è€…æŠŠå®ƒä»¬å½“ä½œå‚æ•°ä¼ é€’ï¼Œæˆ‘ä»¬çš„åº”ç”¨ä¹Ÿæ›´åŠ çµæ´»ï¼›å› ä¸ºæ•°æ®åº“æˆ–è€…é‚®ä»¶å®¢æˆ·ç«¯ç­‰ç­‰éƒ½å‚æ•°åŒ–äº†ã€‚å¦‚æœè¦ä½¿ç”¨å¦ä¸€ä¸ª `Db`ï¼Œåªéœ€æŠŠå®ƒä¼ ç»™å‡½æ•°å°±è¡Œäº†ã€‚å¦‚æœæƒ³åœ¨ä¸€ä¸ªæ–°åº”ç”¨ä¸­ä½¿ç”¨è¿™ä¸ªå¯é çš„å‡½æ•°ï¼Œå°½ç®¡æŠŠæ–°çš„ `Db` å’Œ `Email` ä¼ é€’è¿‡å»å°±å¥½äº†ï¼Œéå¸¸ç®€å•ã€‚

å‘½ä»¤å¼ç¼–ç¨‹ä¸­â€œå…¸å‹â€çš„æ–¹æ³•å’Œè¿‡ç¨‹éƒ½æ·±æ·±åœ°æ ¹æ¤äºå®ƒä»¬æ‰€åœ¨çš„ç¯å¢ƒä¸­ï¼Œé€šè¿‡çŠ¶æ€ã€ä¾èµ–å’Œæœ‰æ•ˆä½œç”¨ï¼ˆ`available effects`ï¼‰è¾¾æˆï¼›çº¯å‡½æ•°ä¸æ­¤ç›¸åï¼Œå®ƒä¸ç¯å¢ƒæ— å…³ï¼Œåªè¦æˆ‘ä»¬æ„¿æ„ï¼Œå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è¿è¡Œå®ƒã€‚

#### 2.4.3 å¯æµ‹è¯•æ€§ï¼ˆTestableï¼‰

çº¯å‡½æ•°è®©æµ‹è¯•æ›´åŠ å®¹æ˜“ã€‚æˆ‘ä»¬ä¸éœ€è¦ä¼ªé€ ä¸€ä¸ªâ€œçœŸå®çš„â€æ”¯ä»˜ç½‘å…³ï¼Œæˆ–è€…æ¯ä¸€æ¬¡æµ‹è¯•ä¹‹å‰éƒ½è¦é…ç½®ã€ä¹‹åéƒ½è¦æ–­è¨€çŠ¶æ€ï¼ˆ`assert the state`ï¼‰ã€‚åªéœ€ç®€å•åœ°ç»™å‡½æ•°ä¸€ä¸ªè¾“å…¥ï¼Œç„¶åæ–­è¨€è¾“å‡ºå°±å¥½äº†ã€‚

#### 2.4.4 åˆç†æ€§ï¼ˆReasonableï¼‰

å¾ˆå¤šäººç›¸ä¿¡ä½¿ç”¨çº¯å‡½æ•°æœ€å¤§çš„å¥½å¤„æ˜¯å¼•ç”¨é€æ˜æ€§ï¼ˆreferential transparencyï¼‰ã€‚å¦‚æœä¸€æ®µä»£ç å¯ä»¥æ›¿æ¢æˆå®ƒæ‰§è¡Œæ‰€å¾—çš„ç»“æœï¼Œè€Œä¸”æ˜¯åœ¨ä¸æ”¹å˜æ•´ä¸ªç¨‹åºè¡Œä¸ºçš„å‰æä¸‹æ›¿æ¢çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¯´è¿™æ®µä»£ç æ˜¯å¼•ç”¨é€æ˜çš„ã€‚

ç”±äºçº¯å‡½æ•°æ€»æ˜¯èƒ½å¤Ÿæ ¹æ®ç›¸åŒçš„è¾“å…¥è¿”å›ç›¸åŒçš„è¾“å‡ºï¼Œæ‰€ä»¥å®ƒä»¬å°±èƒ½å¤Ÿä¿è¯æ€»æ˜¯è¿”å›åŒä¸€ä¸ªç»“æœï¼Œè¿™ä¹Ÿå°±ä¿è¯äº†å¼•ç”¨é€æ˜æ€§ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š

```javascript
var Immutable = require('immutable');

var decrementHP = function(player) {
  return player.set("hp", player.hp-1);
};

var isSameTeam = function(player1, player2) {
  return player1.team === player2.team;
};

var punch = function(player, target) {
  if(isSameTeam(player, target)) {
    return target;
  } else {
    return decrementHP(target);
  }
};

var jobe = Immutable.Map({name:"Jobe", hp:20, team: "red"});
var michael = Immutable.Map({name:"Michael", hp:20, team: "green"});

punch(jobe, michael);
//=> Immutable.Map({name:"Michael", hp:19, team: "green"})
```

`decrementHP`ã€`isSameTeam` å’Œ `punch` éƒ½æ˜¯çº¯å‡½æ•°ï¼Œæ‰€ä»¥æ˜¯å¼•ç”¨é€æ˜çš„ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ç§å«åšâ€œç­‰å¼æ¨å¯¼â€ï¼ˆ`equational reasoning`ï¼‰çš„æ–¹æ³•æ¥åˆ†æä»£ç ã€‚æ‰€è°“â€œç­‰å¼æ¨å¯¼â€å°±æ˜¯â€œä¸€å¯¹ä¸€â€æ›¿æ¢ï¼Œæœ‰ç‚¹åƒåœ¨ä¸è€ƒè™‘ç¨‹åºæ€§æ‰§è¡Œçš„æ€ªå¼‚è¡Œä¸ºï¼ˆ`quirks of programmatic evaluation`ï¼‰çš„æƒ…å†µä¸‹ï¼Œæ‰‹åŠ¨æ‰§è¡Œç›¸å…³ä»£ç ã€‚æˆ‘ä»¬å€ŸåŠ©å¼•ç”¨é€æ˜æ€§æ¥å‰–æä¸€ä¸‹è¿™æ®µä»£ç ã€‚

é¦–å…ˆå†…è” `isSameTeam` å‡½æ•°ï¼š

```javascript
var punch = function(player, target) {
  if(player.team === target.team) {
    return target;
  } else {
    return decrementHP(target);
  }
};
```

å› ä¸ºæ˜¯ä¸å¯å˜æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æŠŠ `team` æ›¿æ¢ä¸ºå®é™…å€¼ï¼š

```javascript
var punch = function(player, target) {
  if("red" === "green") {
    return target;
  } else {
    return decrementHP(target);
  }
};
```

if è¯­å¥æ‰§è¡Œç»“æœä¸º falseï¼Œæ‰€ä»¥å¯ä»¥æŠŠæ•´ä¸ª if è¯­å¥éƒ½åˆ æ‰ï¼š

```javascript
var punch = function(player, target) {
  return decrementHP(target);
};
```

å¦‚æœå†å†…è” `decrementHP`ï¼Œæˆ‘ä»¬ä¼šå‘ç°è¿™ç§æƒ…å†µä¸‹ï¼Œpunch å˜æˆäº†ä¸€ä¸ªè®© hp çš„å€¼å‡ 1 çš„è°ƒç”¨ï¼š

```javascript
var punch = function(player, target) {
  return target.set("hp", target.hp-1);
};
```

ç­‰å¼æ¨å¯¼å¸¦æ¥çš„åˆ†æä»£ç çš„èƒ½åŠ›å¯¹é‡æ„å’Œç†è§£ä»£ç éå¸¸é‡è¦ã€‚äº‹å®ä¸Šï¼Œæˆ‘ä»¬é‡æ„æµ·é¸¥ç¨‹åºä½¿ç”¨çš„æ­£æ˜¯è¿™é¡¹æŠ€æœ¯ï¼šåˆ©ç”¨åŠ å’Œä¹˜çš„ç‰¹æ€§ã€‚

#### 2.4.5 å¹¶è¡Œä»£ç 

æœ€åä¸€ç‚¹ï¼Œä¹Ÿæ˜¯å†³å®šæ€§çš„ä¸€ç‚¹ï¼šæˆ‘ä»¬å¯ä»¥å¹¶è¡Œè¿è¡Œä»»æ„çº¯å‡½æ•°ã€‚å› ä¸ºçº¯å‡½æ•°æ ¹æœ¬ä¸éœ€è¦è®¿é—®å…±äº«çš„å†…å­˜ï¼Œè€Œä¸”æ ¹æ®å…¶å®šä¹‰ï¼Œçº¯å‡½æ•°ä¹Ÿä¸ä¼šå› å‰¯ä½œç”¨è€Œè¿›å…¥ç«äº‰æ€ï¼ˆ`race condition`ï¼‰ã€‚

å¹¶è¡Œä»£ç åœ¨æœåŠ¡ç«¯ js ç¯å¢ƒä»¥åŠä½¿ç”¨äº† web worker çš„æµè§ˆå™¨é‚£é‡Œæ˜¯éå¸¸å®¹æ˜“å®ç°çš„ï¼Œå› ä¸ºå®ƒä»¬ä½¿ç”¨äº†çº¿ç¨‹ï¼ˆthreadï¼‰ã€‚ä¸è¿‡å‡ºäºå¯¹éçº¯å‡½æ•°å¤æ‚åº¦çš„è€ƒè™‘ï¼Œå½“å‰ä¸»æµè§‚ç‚¹è¿˜æ˜¯é¿å…ä½¿ç”¨è¿™ç§å¹¶è¡Œã€‚

## ä¸‰ã€æŸ¯é‡ŒåŒ–

### 3.1 ä»€ä¹ˆæ˜¯æŸ¯é‡ŒåŒ–

curry çš„æ¦‚å¿µå¾ˆç®€å•ï¼šåªä¼ é€’ç»™å‡½æ•°ä¸€éƒ¨åˆ†å‚æ•°æ¥è°ƒç”¨å®ƒï¼Œè®©å®ƒè¿”å›ä¸€ä¸ªå‡½æ•°å»å¤„ç†å‰©ä¸‹çš„å‚æ•°ã€‚

ä½ å¯ä»¥ä¸€æ¬¡æ€§åœ°è°ƒç”¨ curry å‡½æ•°ï¼Œä¹Ÿå¯ä»¥æ¯æ¬¡åªä¼ ä¸€ä¸ªå‚æ•°åˆ†å¤šæ¬¡è°ƒç”¨ã€‚

```javascript
var add = function(x) {
  return function(y) {
    return x + y;
  };
};

var increment = add(1);
var addTen = add(10);

increment(2);
// 3

addTen(2);
// 12
```

è¿™é‡Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª add å‡½æ•°ï¼Œå®ƒæ¥å—ä¸€ä¸ªå‚æ•°å¹¶è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ã€‚è°ƒç”¨ add ä¹‹åï¼Œè¿”å›çš„å‡½æ•°å°±é€šè¿‡é—­åŒ…çš„æ–¹å¼è®°ä½äº† add çš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚ä¸€æ¬¡æ€§åœ°è°ƒç”¨å®ƒå®åœ¨æ˜¯æœ‰ç‚¹ç¹çï¼Œå¥½åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç‰¹æ®Šçš„ curry å¸®åŠ©å‡½æ•°ï¼ˆ`helper function`ï¼‰ä½¿è¿™ç±»å‡½æ•°çš„å®šä¹‰å’Œè°ƒç”¨æ›´åŠ å®¹æ˜“ã€‚

```javascript
var curry = require('lodash').curry;

var match = curry(function(what, str) {
  return str.match(what);
});

var replace = curry(function(what, replacement, str) {
  return str.replace(what, replacement);
});

var filter = curry(function(f, ary) {
  return ary.filter(f);
});

var map = curry(function(f, ary) {
  return ary.map(f);
});
```

åœ¨ä¸Šé¢çš„ä»£ç ä¸­éµå¾ªçš„æ˜¯ä¸€ç§ç®€å•ï¼ŒåŒæ—¶ä¹Ÿéå¸¸é‡è¦çš„æ¨¡å¼ã€‚å³ç­–ç•¥æ€§åœ°æŠŠè¦æ“ä½œçš„æ•°æ®ï¼ˆ`String`ï¼Œ `Array`ï¼‰æ”¾åˆ°æœ€åä¸€ä¸ªå‚æ•°é‡Œã€‚åˆ°ä½¿ç”¨å®ƒä»¬çš„æ—¶å€™ä½ å°±æ˜ç™½è¿™æ ·åšçš„åŸå› æ˜¯ä»€ä¹ˆäº†ã€‚

```javascript
match(/\s+/g, "hello world");
// [ ' ' ]

match(/\s+/g)("hello world");
// [ ' ' ]

var hasSpaces = match(/\s+/g);
// function(x) { return x.match(/\s+/g) }

hasSpaces("hello world");
// [ ' ' ]

hasSpaces("spaceless");
// null

filter(hasSpaces, ["tori_spelling", "tori amos"]);
// ["tori amos"]

var findSpaces = filter(hasSpaces);
// function(xs) { return xs.filter(function(x) { return x.match(/\s+/g) }) }

findSpaces(["tori_spelling", "tori amos"]);
// ["tori amos"]

var noVowels = replace(/[aeiou]/ig);
// function(replacement, x) { return x.replace(/[aeiou]/ig, replacement) }

var censored = noVowels("*");
// function(x) { return x.replace(/[aeiou]/ig, "*") }

censored("Chocolate Rain");
// 'Ch*c*l*t* R**n'
```

è¿™é‡Œè¡¨æ˜çš„æ˜¯ä¸€ç§â€œé¢„åŠ è½½â€å‡½æ•°çš„èƒ½åŠ›ï¼Œé€šè¿‡ä¼ é€’ä¸€åˆ°ä¸¤ä¸ªå‚æ•°è°ƒç”¨å‡½æ•°ï¼Œå°±èƒ½å¾—åˆ°ä¸€ä¸ªè®°ä½äº†è¿™äº›å‚æ•°çš„æ–°å‡½æ•°ã€‚

### 3.2 ä½¿ç”¨ç”¨é€”

curry çš„ç”¨å¤„éå¸¸å¹¿æ³›ï¼Œå°±åƒåœ¨ `hasSpaces`ã€`findSpaces` å’Œ `censored` çœ‹åˆ°çš„é‚£æ ·ï¼Œåªéœ€ä¼ ç»™å‡½æ•°ä¸€äº›å‚æ•°ï¼Œå°±èƒ½å¾—åˆ°ä¸€ä¸ªæ–°å‡½æ•°ã€‚

ç”¨ map ç®€å•åœ°æŠŠå‚æ•°æ˜¯å•ä¸ªå…ƒç´ çš„å‡½æ•°åŒ…è£¹ä¸€ä¸‹ï¼Œå°±èƒ½æŠŠå®ƒè½¬æ¢æˆå‚æ•°ä¸ºæ•°ç»„çš„å‡½æ•°ã€‚

```JavaScript
var getChildren = function(x) {
  return x.childNodes;
};

var allTheChildren = map(getChildren);
```

åªä¼ ç»™å‡½æ•°ä¸€éƒ¨åˆ†å‚æ•°é€šå¸¸ä¹Ÿå«åšå±€éƒ¨è°ƒç”¨ï¼ˆ`partial application`ï¼‰ï¼Œèƒ½å¤Ÿå¤§é‡å‡å°‘æ ·æ¿æ–‡ä»¶ä»£ç ï¼ˆboilerplate codeï¼‰ã€‚è€ƒè™‘ä¸Šé¢çš„ allTheChildren å‡½æ•°ï¼Œå¦‚æœç”¨ lodash çš„æ™®é€š map æ¥å†™ä¼šæ˜¯ä»€ä¹ˆæ ·çš„ï¼ˆæ³¨æ„å‚æ•°çš„é¡ºåºä¹Ÿå˜äº†ï¼‰ï¼š

```JavaScript
var allTheChildren = function(elements) {
  return _.map(elements, getChildren);
};
```

é€šå¸¸æˆ‘ä»¬ä¸å®šä¹‰ç›´æ¥æ“ä½œæ•°ç»„çš„å‡½æ•°ï¼Œå› ä¸ºåªéœ€å†…è”è°ƒç”¨ `map(getChildren)` å°±èƒ½è¾¾åˆ°ç›®çš„ã€‚è¿™ä¸€ç‚¹åŒæ ·é€‚ç”¨äº sortã€filter ä»¥åŠå…¶ä»–çš„é«˜é˜¶å‡½æ•°ï¼ˆ`higher order function`ï¼‰ï¼ˆé«˜é˜¶å‡½æ•°ï¼šå‚æ•°æˆ–è¿”å›å€¼ä¸ºå‡½æ•°çš„å‡½æ•°ï¼‰ã€‚

å½“æˆ‘ä»¬è°ˆè®ºçº¯å‡½æ•°çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¯´å®ƒä»¬æ¥å—ä¸€ä¸ªè¾“å…¥è¿”å›ä¸€ä¸ªè¾“å‡ºã€‚curry å‡½æ•°æ‰€åšçš„æ­£æ˜¯è¿™æ ·ï¼šæ¯ä¼ é€’ä¸€ä¸ªå‚æ•°è°ƒç”¨å‡½æ•°ï¼Œå°±è¿”å›ä¸€ä¸ªæ–°å‡½æ•°å¤„ç†å‰©ä½™çš„å‚æ•°ã€‚è¿™å°±æ˜¯ä¸€ä¸ªè¾“å…¥å¯¹åº”ä¸€ä¸ªè¾“å‡ºå•Šã€‚

å“ªæ€•è¾“å‡ºæ˜¯å¦ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒä¹Ÿæ˜¯çº¯å‡½æ•°ã€‚å½“ç„¶ curry å‡½æ•°ä¹Ÿå…è®¸ä¸€æ¬¡ä¼ é€’å¤šä¸ªå‚æ•°ï¼Œä½†è¿™åªæ˜¯å‡ºäºå‡å°‘ () çš„æ–¹ä¾¿ã€‚

### 3.3 å®ç°

```javascript
function curry(fn) {
  // å‚æ•°ä¸ªæ•°
  const len = fn.length;

  return function curried(...args) {
    // åˆ¤æ–­é•¿åº¦
    // å¦‚æœæ”¶é›†åˆ°çš„å‚æ•°å¤§äºäº†å‡½æ•°æœ¬èº«å‚æ•°é•¿åº¦ï¼Œæ‰§è¡Œå‡½æ•°
    if (args.length >= len) {
      // æ­¤æ—¶ args å‚æ•°æ”¶é›†å®Œæ¯•
      return fn.apply(this, args);
    } else {
      // å¦åˆ™ï¼Œç»§ç»­æ”¶é›†å‚æ•°ï¼ˆç»§ç»­é—­åŒ…ï¼‰
      return function (...args2) {
        console.log("ğŸš€", "ç»§ç»­æ”¶é›†");
        // å‚æ•°æ‹¼æ¥
        return curried.apply(this, args.concat(args2));
      };
    }
  };
}

function add(a, b, c) {
  return a + b + c;
}

const curriedAdd = curry(add);

console.log(curriedAdd(1, 2, 3, 4, 5, 6)); // 3
console.log(curriedAdd(1)(2)(3)); // 3
console.log(curriedAdd(1)(2, 3)); // 3
console.log(curriedAdd(1, 2)(3)); // 3
```



## å››ã€ä»£ç ç»„åˆ

### 4.1 ä»€ä¹ˆæ˜¯ä»£ç ç»„åˆ

```javascript
var compose = function(f,g) {
  return function(x) {
    return f(g(x));
  };
};
```

f å’Œ g éƒ½æ˜¯å‡½æ•°ï¼Œx æ˜¯åœ¨å®ƒä»¬ä¹‹é—´é€šè¿‡â€œç®¡é“â€ä¼ è¾“çš„å€¼ã€‚

ç»„åˆçœ‹èµ·æ¥åƒæ˜¯åœ¨é¥²å…»å‡½æ•°ã€‚ä½ å°±æ˜¯é¥²å…»å‘˜ï¼Œé€‰æ‹©ä¸¤ä¸ªæœ‰ç‰¹ç‚¹åˆé­ä½ å–œæ¬¢çš„å‡½æ•°ï¼Œè®©å®ƒä»¬ç»“åˆï¼Œäº§ä¸‹ä¸€ä¸ªå´­æ–°çš„å‡½æ•°ã€‚ç»„åˆçš„ç”¨æ³•å¦‚ä¸‹ï¼š

```javascript
var toUpperCase = function(x) { return x.toUpperCase(); };
var exclaim = function(x) { return x + '!'; };
var shout = compose(exclaim, toUpperCase);

shout("send in the clowns");
//=> "SEND IN THE CLOWNS!"
```

ä»£ç ç»„åˆï¼šä¸¤ä¸ªå‡½æ•°ç»„åˆä¹‹åè¿”å›äº†ä¸€ä¸ªæ–°å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯ç»„åˆæŸç§ç±»å‹ï¼ˆæœ¬ä¾‹ä¸­æ˜¯å‡½æ•°ï¼‰çš„ä¸¤ä¸ªå…ƒç´ æœ¬å°±è¯¥ç”Ÿæˆä¸€ä¸ªè¯¥ç±»å‹çš„æ–°å…ƒç´ ã€‚

åœ¨ `compose` çš„å®šä¹‰ä¸­ï¼Œg å°†å…ˆäº f æ‰§è¡Œï¼Œå› æ­¤å°±åˆ›å»ºäº†ä¸€ä¸ªä»å³åˆ°å·¦çš„æ•°æ®æµã€‚

åœ¨ `pipe` çš„å®šä¹‰ä¸­ï¼Œf å°†å…ˆäº g æ‰§è¡Œï¼Œå› æ­¤å°±åˆ›å»ºäº†ä¸€ä¸ªä»å·¦åˆ°å³çš„æ•°æ®æµã€‚

è¿™æ ·åšçš„å¯è¯»æ€§è¿œè¿œé«˜äºåµŒå¥—ä¸€å¤§å †çš„å‡½æ•°è°ƒç”¨ï¼Œå¦‚æœä¸ç”¨ç»„åˆï¼Œshout å‡½æ•°å°†ä¼šæ˜¯è¿™æ ·çš„ï¼š

```javascript
var shout = function(x){
  return exclaim(toUpperCase(x));
};
```

è®©ä»£ç ä»å³å‘å·¦è¿è¡Œï¼Œè€Œä¸æ˜¯ç”±å†…è€Œå¤–è¿è¡Œï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªé¡ºåºå¾ˆé‡è¦çš„ä¾‹å­ï¼š

```javascript
var head = function(x) { return x[0]; };
var reverse = reduce(function(acc, x){ return [x].concat(acc); }, []);
var last = compose(head, reverse);

last(['jumpkick', 'roundhouse', 'uppercut']);
//=> 'uppercut'
```

`reverse` åè½¬åˆ—è¡¨ï¼Œ`head` å–åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼›æ‰€ä»¥ç»“æœå°±æ˜¯å¾—åˆ°äº†ä¸€ä¸ª last å‡½æ•°ï¼ˆè¯‘è€…æ³¨ï¼šå³å–åˆ—è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œè™½ç„¶å®ƒæ€§èƒ½ä¸é«˜ã€‚è¿™ä¸ªç»„åˆä¸­å‡½æ•°çš„æ‰§è¡Œé¡ºåºåº”è¯¥æ˜¯æ˜¾è€Œæ˜“è§çš„ã€‚å°½ç®¡æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªä»å·¦å‘å³çš„ç‰ˆæœ¬ï¼Œä½†æ˜¯ä»å³å‘å·¦æ‰§è¡Œæ›´åŠ èƒ½å¤Ÿåæ˜ æ•°å­¦ä¸Šçš„å«ä¹‰ã€‚

```javascript
// ç»“åˆå¾‹ï¼ˆassociativityï¼‰
var associative = compose(f, compose(g, h)) == compose(compose(f, g), h);
// true
```

æ„å‘³ç€ä¸ç®¡ä½ æ˜¯æŠŠ g å’Œ h åˆ†åˆ°ä¸€ç»„ï¼Œè¿˜æ˜¯æŠŠ f å’Œ g åˆ†åˆ°ä¸€ç»„éƒ½ä¸é‡è¦ã€‚æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬æƒ³æŠŠå­—ç¬¦ä¸²å˜ä¸ºå¤§å†™ï¼Œå¯ä»¥è¿™ä¹ˆå†™ï¼š

```javascript
compose(toUpperCase, compose(head, reverse));

// æˆ–è€…
compose(compose(toUpperCase, head), reverse);
```

å› ä¸ºå¦‚ä½•ä¸º `compose` çš„è°ƒç”¨åˆ†ç»„ä¸é‡è¦ï¼Œæ‰€ä»¥ç»“æœéƒ½æ˜¯ä¸€æ ·çš„ã€‚è¿™ä¹Ÿè®©æˆ‘ä»¬æœ‰èƒ½åŠ›å†™ä¸€ä¸ªå¯å˜çš„ç»„åˆï¼ˆ`variadic compose`ï¼‰ï¼Œç”¨æ³•å¦‚ä¸‹ï¼š

```javascript
// å‰é¢çš„ä¾‹å­ä¸­æˆ‘ä»¬å¿…é¡»è¦å†™ä¸¤ä¸ªç»„åˆæ‰è¡Œï¼Œä½†æ—¢ç„¶ç»„åˆæ˜¯ç¬¦åˆç»“åˆå¾‹çš„ï¼Œæˆ‘ä»¬å°±å¯ä»¥åªå†™ä¸€ä¸ªï¼Œ
// è€Œä¸”æƒ³ä¼ ç»™å®ƒå¤šå°‘ä¸ªå‡½æ•°å°±ä¼ ç»™å®ƒå¤šå°‘ä¸ªï¼Œç„¶åè®©å®ƒè‡ªå·±å†³å®šå¦‚ä½•åˆ†ç»„ã€‚

var lastUpper = compose(toUpperCase, head, reverse);

lastUpper(['jumpkick', 'roundhouse', 'uppercut']);
//=> 'UPPERCUT'


var loudLastUpper = compose(exclaim, toUpperCase, head, reverse)

loudLastUpper(['jumpkick', 'roundhouse', 'uppercut']);
//=> 'UPPERCUT!'
```

è¿ç”¨ç»“åˆå¾‹èƒ½ä¸ºæˆ‘ä»¬å¸¦æ¥å¼ºå¤§çš„çµæ´»æ€§ï¼Œè€Œä¸”ä½ ä¹Ÿå¯ä»¥åœ¨ç±»ä¼¼ [lodash](https://lodash.com/)ã€[underscore](http://underscorejs.org/) ä»¥åŠ [ramda](http://ramdajs.com/) è¿™æ ·çš„ç±»åº“ä¸­æ‰¾åˆ°å®ƒä»¬çš„å¸¸è§„å®šä¹‰ã€‚

ç»“åˆå¾‹çš„ä¸€å¤§å¥½å¤„æ˜¯ä»»ä½•ä¸€ä¸ªå‡½æ•°åˆ†ç»„éƒ½å¯ä»¥è¢«æ‹†å¼€æ¥ï¼Œç„¶åå†ä»¥å®ƒä»¬è‡ªå·±çš„ç»„åˆæ–¹å¼æ‰“åŒ…åœ¨ä¸€èµ·ã€‚è®©æˆ‘ä»¬æ¥é‡æ„é‡æ„å‰é¢çš„ä¾‹å­ï¼š

```javascript
var loudLastUpper = compose(exclaim, toUpperCase, head, reverse);

// æˆ–
var last = compose(head, reverse);
var loudLastUpper = compose(exclaim, toUpperCase, last);

// æˆ–
var last = compose(head, reverse);
var angry = compose(exclaim, toUpperCase);
var loudLastUpper = compose(angry, last);
```

composeå®ç°

```javascript
function compose(...fns) {
  // é—­åŒ…
  if (fns.length === 0) {
    return (arg) => arg;
  }

  if (fns.length === 1) {
    return fns[0];
  }

  // æ•°ç»„çš„ reduce
  return fns.reduce(
    (a, b) =>
      (...args) =>
        a(b(...args))
  );
}

function map(arr) {
  return arr.map((item) => item + "ğŸš€");
}

const composedFn = compose(console.log, map, splitStr, upperCase);

composedFn(str);
```



### 4.2 pointfree

pointfree æ¨¡å¼æŒ‡çš„æ˜¯ï¼Œæ°¸è¿œä¸å¿…è¯´å‡ºä½ çš„æ•°æ®ã€‚å®ƒçš„æ„æ€æ˜¯è¯´ï¼Œå‡½æ•°æ— é¡»æåŠå°†è¦æ“ä½œçš„æ•°æ®æ˜¯ä»€ä¹ˆæ ·çš„ã€‚ä¸€ç­‰å…¬æ°‘çš„å‡½æ•°ã€æŸ¯é‡ŒåŒ–ï¼ˆcurryï¼‰ä»¥åŠç»„åˆåä½œèµ·æ¥éå¸¸æœ‰åŠ©äºå®ç°è¿™ç§æ¨¡å¼ã€‚

```javascript
// é pointfreeï¼Œå› ä¸ºæåˆ°äº†æ•°æ®ï¼šword
var snakeCase = function (word) {
  return word.toLowerCase().replace(/\s+/ig, '_');
};

// pointfree
var snakeCase = compose(replace(/\s+/ig, '_'), toLowerCase);
```

è¿™é‡Œæ‰€åšçš„äº‹æƒ…å°±æ˜¯é€šè¿‡ç®¡é“æŠŠæ•°æ®åœ¨æ¥å—å•ä¸ªå‚æ•°çš„å‡½æ•°é—´ä¼ é€’ã€‚åˆ©ç”¨ curryï¼Œæˆ‘ä»¬èƒ½å¤Ÿåšåˆ°è®©æ¯ä¸ªå‡½æ•°éƒ½å…ˆæ¥æ”¶æ•°æ®ï¼Œç„¶åæ“ä½œæ•°æ®ï¼Œæœ€åå†æŠŠæ•°æ®ä¼ é€’åˆ°ä¸‹ä¸€ä¸ªå‡½æ•°é‚£é‡Œå»ã€‚å¦å¤–æ³¨æ„åœ¨ pointfree ç‰ˆæœ¬ä¸­ï¼Œä¸éœ€è¦ word å‚æ•°å°±èƒ½æ„é€ å‡½æ•°ï¼›è€Œåœ¨é pointfree çš„ç‰ˆæœ¬ä¸­ï¼Œå¿…é¡»è¦æœ‰ word æ‰èƒ½è¿›è¡Œä¸€åˆ‡æ“ä½œã€‚

å†æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š

```javascript
// é pointfreeï¼Œå› ä¸ºæåˆ°äº†æ•°æ®ï¼šname
var initials = function (name) {
  return name.split(' ').map(compose(toUpperCase, head)).join('. ');
};

// pointfree
var initials = compose(join('. '), map(compose(toUpperCase, head)), split(' '));

initials("hunter stockton thompson");
// 'H. S. T'
```

pointfree æ¨¡å¼èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬å‡å°‘ä¸å¿…è¦çš„å‘½åï¼Œè®©ä»£ç ä¿æŒç®€æ´å’Œé€šç”¨ã€‚å¯¹å‡½æ•°å¼ä»£ç æ¥è¯´ï¼Œpointfree æ˜¯éå¸¸å¥½çš„çŸ³è•Šè¯•éªŒï¼Œå› ä¸ºå®ƒèƒ½å‘Šè¯‰æˆ‘ä»¬ä¸€ä¸ªå‡½æ•°æ˜¯å¦æ˜¯æ¥å—è¾“å…¥è¿”å›è¾“å‡ºçš„å°å‡½æ•°ã€‚æ¯”å¦‚ï¼Œwhile å¾ªç¯æ˜¯ä¸èƒ½ç»„åˆçš„ã€‚ä¸è¿‡ä½ ä¹Ÿè¦è­¦æƒ•ï¼Œpointfree å°±åƒæ˜¯ä¸€æŠŠåŒåˆƒå‰‘ï¼Œæœ‰æ—¶å€™ä¹Ÿèƒ½æ··æ·†è§†å¬ã€‚å¹¶éæ‰€æœ‰çš„å‡½æ•°å¼ä»£ç éƒ½æ˜¯ pointfree çš„ï¼Œä¸è¿‡è¿™æ²¡å…³ç³»ã€‚å¯ä»¥ä½¿ç”¨å®ƒçš„æ—¶å€™å°±ä½¿ç”¨ï¼Œä¸èƒ½ä½¿ç”¨çš„æ—¶å€™å°±ç”¨æ™®é€šå‡½æ•°ã€‚

### 4.3 debug

ç»„åˆçš„ä¸€ä¸ªå¸¸è§é”™è¯¯æ˜¯ï¼Œåœ¨æ²¡æœ‰å±€éƒ¨è°ƒç”¨ä¹‹å‰ï¼Œå°±ç»„åˆç±»ä¼¼ map è¿™æ ·æ¥å—ä¸¤ä¸ªå‚æ•°çš„å‡½æ•°ã€‚

```javascript
// é”™è¯¯åšæ³•ï¼šæˆ‘ä»¬ä¼ ç»™äº† `angry` ä¸€ä¸ªæ•°ç»„ï¼Œæ ¹æœ¬ä¸çŸ¥é“æœ€åä¼ ç»™ `map` çš„æ˜¯ä»€ä¹ˆä¸œè¥¿ã€‚
var latin = compose(map, angry, reverse);

latin(["frog", "eyes"]);
// error


// æ­£ç¡®åšæ³•ï¼šæ¯ä¸ªå‡½æ•°éƒ½æ¥å—ä¸€ä¸ªå®é™…å‚æ•°ã€‚
var latin = compose(map(angry), reverse);

latin(["frog", "eyes"]);
// ["EYES!", "FROG!"])
```

å¦‚æœåœ¨ debug ç»„åˆçš„æ—¶å€™é‡åˆ°äº†å›°éš¾ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ä¸‹é¢è¿™ä¸ªå®ç”¨çš„ï¼Œä½†æ˜¯ä¸çº¯çš„ trace å‡½æ•°æ¥è¿½è¸ªä»£ç çš„æ‰§è¡Œæƒ…å†µã€‚

```javascript
var trace = curry(function(tag, x){
  console.log(tag, x);
  return x;
});

var dasherize = compose(join('-'), toLower, split(' '), replace(/\s{2,}/ig, ' '));

dasherize('The world is a vampire');
// TypeError: Cannot read property 'apply' of undefined
```

toLower çš„å‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ‰€ä»¥éœ€è¦å…ˆç”¨ map è°ƒç”¨ä¸€ä¸‹å®ƒã€‚

```javascript
var dasherize = compose(join('-'), map(toLower), split(' '), replace(/\s{2,}/ig, ' '));

dasherize('The world is a vampire');

// 'the-world-is-a-vampire'
```



















































